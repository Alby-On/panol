<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Historial de Solicitudes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        font-family: Arial;
        background: #f5f5f5;
        margin: 0;
        padding: 15px;
    }
    .box {
        background: white;
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 12px #ccc;
        margin-bottom: 20px;
    }
    h2 {
        text-align: center;
        margin-bottom: 15px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        font-size: 14px;
        text-align: left;
    }
    th {
        background: #007bff;
        color: white;
    }
    .btnVolver {
        background: #6c757d;
        padding: 12px;
        width: 100%;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        cursor: pointer;
    }
    .btnVolver:hover { background: #565e64; }
    .solicitud-header {
        margin-bottom: 8px;
        font-weight: bold;
    }
</style>
</head>
<body>

<div class="box">
    <h2>Historial de Solicitudes Entregadas</h2>
    <div id="historialContainer">
        <p>Cargando historial...</p>
    </div>
    <button class="btnVolver" onclick="location.href='menu.html'">Volver al Menú</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxKBcwZNWU2HpqhO40VxW1r3BQtdv9i3vF4sDQT4Luh1RINjCysBv4i0v6crhMSIJsc/exec"; // reemplaza con tu URL del Apps Script

// Cargar historial del usuario logueado
async function cargarHistorial() {
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user) {
        alert("Usuario no encontrado. Inicie sesión nuevamente.");
        location.href = "index.html";
        return;
    }

    try {
        const res = await fetch(`${API_URL}?action=getHistorial&email=${encodeURIComponent(user.email)}`);
        const json = await res.json();

        const container = document.getElementById("historialContainer");
        container.innerHTML = "";

        if (!json.ok || json.data.length === 0) {
            container.innerHTML = "<p>No hay solicitudes entregadas.</p>";
            return;
        }

        json.data.forEach(solicitud => {
            const div = document.createElement("div");
            div.className = "solicitud-box";
            div.style.marginBottom = "15px";
            div.style.padding = "12px";
            div.style.border = "1px solid #ccc";
            div.style.borderRadius = "8px";
            div.style.background = "#f8f9fa";

            let html = `<div class="solicitud-header">Solicitud #${solicitud.id} - ${solicitud.fecha}</div>`;
            html += `<p><b>Docente:</b> ${solicitud.docente}</p>`;
            html += `<p><b>Asignatura:</b> ${solicitud.asignatura}</p>`;

            html += `<table>
                        <thead>
                            <tr><th>Material</th><th>Cantidad</th></tr>
                        </thead>
                        <tbody>`;
            solicitud.materiales.forEach(mat => {
                html += `<tr><td>${mat.nombre}</td><td>${mat.cantidad}</td></tr>`;
            });
            html += `</tbody></table>`;

            div.innerHTML = html;
            container.appendChild(div);
        });

    } catch (err) {
        console.error(err);
        document.getElementById("historialContainer").innerHTML = "<p>Error al cargar historial.</p>";
    }
}

// Ejecutar al cargar la página
cargarHistorial();
</script>

</body>
</html>



