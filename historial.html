<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Historial de Solicitudes</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background: #f0f2f5; padding:20px; margin:0;}
.box { background:white; max-width:600px; margin:auto; padding:20px; margin-top:15px; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.15);}
h2{text-align:center;}
.solicitud {background:#f8f9fa; padding:12px; border-left:5px solid #17a2b8; margin-bottom:12px; border-radius:8px;}
.btnVolver {background:#6c757d; color:white; width:100%; padding:12px; border:none; border-radius:6px; font-size:17px; cursor:pointer; margin-top:15px;}
</style>
</head>
<body>

<div class="box">
<h2>Historial de Solicitudes</h2>
<div id="listado">Cargando historial...</div>
<button class="btnVolver" onclick="location.href='menu.html'">Volver</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/library/d/1bSwCYfW82kcUZ5lTIc5O-wVUzmG6o_nAvOP7Ral7l0BgGeU9t2RAo1ww/4"; // reemplaza con tu URL del Web App

const user = JSON.parse(localStorage.getItem("currentUser"));
if (!user) location.href="index.html";

async function cargarHistorial() {
    const cont = document.getElementById("listado");
    try {
        const res = await fetch(`${API_URL}?action=getHistorial&email=${user.email}`);
        const json = await res.json();

        if(!json.ok) { cont.innerHTML="Error al cargar historial."; return; }
        const lista = json.solicitudes;
        if(lista.length===0) { cont.innerHTML="<p>No tienes solicitudes completadas.</p>"; return; }

        cont.innerHTML = "";
        lista.forEach(sol=>{
            const div = document.createElement("div");
            div.className = "solicitud";
            div.innerHTML = `
                <b>ID:</b> ${sol.id}<br>
                <b>Docente:</b> ${sol.docente}<br>
                <b>Asignatura:</b> ${sol.asignatura}<br>
                <b>Fecha:</b> ${sol.fecha}<br>
                <b>Estado:</b> ${sol.estado}<br>
                <button onclick="alert('Aquí podrás ver los materiales');">Ver materiales</button>
            `;
            cont.appendChild(div);
        });
    } catch(err) {
        cont.innerHTML = "Error de conexión.";
    }
}

cargarHistorial();
</script>

</body>
</html>

</html>

