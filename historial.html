<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Historial de Solicitudes</title>

    <style>
        body {
            font-family: Arial;
            background: #f0f2f5;
            padding: 15px;
            margin: 0;
        }

        .box {
            max-width: 600px;
            margin: auto;
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            cursor: pointer;
        }

        .card-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .estado {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 13px;
            color: white;
        }
        .pendiente { background: #ffc107; }
        .entregada { background: #28a745; }

        .materiales {
            margin-top: 12px;
            padding-left: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            font-size: 14px;
        }
        th {
            background: #007bff;
            color: white;
        }

        .volver {
            width: 100%;
            background: #6c757d;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 7px;
            font-size: 16px;
            margin-top: 15px;
            cursor: pointer;
        }
        .volver:hover { background: #565e64; }
    </style>
</head>
<body>

<div class="box">
    <h2>Historial de Solicitudes</h2>

    <div id="contenedorSolicitudes"></div>

    <button class="volver" onclick="location.href='menu.html'">Volver al Menú</button>
</div>

<script>
const API_URL = "TU_URL_DEL_WEBAPP_AQUÍ";

// Usuario actual
const user = JSON.parse(localStorage.getItem("currentUser"));
if (!user) location.href = "index.html";

// -----------------------------------------------------
// Cargar historial desde el servidor
// -----------------------------------------------------
async function cargarHistorial() {
    const res = await fetch(`${API_URL}?action=historial&email=${user.email}`);
    const json = await res.json();

    if (!json.ok) {
        document.getElementById("contenedorSolicitudes").innerHTML =
            "<p>No se pudo cargar el historial.</p>";
        return;
    }

    const solicitudes = json.data.reverse(); // mostrar las más nuevas arriba
    mostrarSolicitudes(solicitudes);
}

// -----------------------------------------------------
// Crear tarjetas visuales
// -----------------------------------------------------
function mostrarSolicitudes(lista) {
    const cont = document.getElementById("contenedorSolicitudes");
    cont.innerHTML = "";

    if (lista.length === 0) {
        cont.innerHTML = "<p>No tienes solicitudes registradas.</p>";
        return;
    }

    lista.forEach(s => {
        const estadoClase = s.estado.toLowerCase() === "entregada" ? "entregada" : "pendiente";

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <div class="card-header" onclick="this.nextElementSibling.classList.toggle('hidden')">
                <h3>Solicitud #${s.id}</h3>
                <span class="estado ${estadoClase}">${s.estado}</span>
            </div>

            <div class="card-body hidden">
                <p><b>Docente:</b> ${s.docente}</p>
                <p><b>Asignatura:</b> ${s.asignatura}</p>
                <p><b>Fecha:</b> ${s.fecha}</p>

                <div class="materiales">
                    <b>Materiales Solicitados:</b>
                    <table>
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Cantidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${s.materiales.map(m => `
                                <tr>
                                    <td>${m.material}</td>
                                    <td>${m.cantidad}</td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>
            </div>
        `;

        cont.appendChild(card);
    });
}

// Ocultar elementos al inicio
document.addEventListener("DOMContentLoaded", () => {
    const style = document.createElement("style");
    style.innerHTML = ".hidden { display: none; }";
    document.body.appendChild(style);
});

// Iniciar carga
cargarHistorial();
</script>

</body>
</html>

