<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Historial de Solicitudes</title>
<style>
body { font-family: Arial; background: #f0f2f5; margin: 0; padding: 20px; }
.box { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
h2 { text-align: center; margin-bottom: 15px; }
table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 14px; }
th { background: #007bff; color: white; }
button { padding: 8px 12px; border: none; border-radius: 5px; background: #28a745; color: white; cursor: pointer; font-size: 14px; margin-top: 5px; }
button:hover { background: #218838; }
.materiales { margin-top: 8px; font-size: 14px; }
label { font-weight: bold; font-size: 14px; }
input[type="date"] { padding: 6px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #aaa; width: 100%; }
</style>
</head>
<body>

<div class="box">
    <h2>Historial de Solicitudes Entregadas</h2>

    <label>Filtrar por fecha:</label>
    <input type="date" id="fechaFiltro">

    <div id="historialContainer">Cargando historial...</div>

    <button onclick="location.href='menu.html'">Volver al Men√∫</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxKBcwZNWU2HpqhO40VxW1r3BQtdv9i3vF4sDQT4Luh1RINjCysBv4i0v6crhMSIJsc/exec";

function mostrarHistorial(data) {
    const container = document.getElementById("historialContainer");
    container.innerHTML = "";

    const fechaFiltro = document.getElementById("fechaFiltro").value;
    let filtradas = data;

    if (fechaFiltro) {
        filtradas = data.filter(s => new Date(s.fecha).toISOString().split('T')[0] === fechaFiltro);
    }

    if (filtradas.length === 0) {
        container.innerHTML = "<p>No hay solicitudes entregadas.</p>";
        return;
    }

    filtradas.forEach(solicitud => {
        const div = document.createElement("div");
        div.style.border = "1px solid #007bff";
        div.style.borderRadius = "8px";
        div.style.padding = "10px";
        div.style.marginBottom = "10px";
        div.innerHTML = `
            <p><b>ID:</b> ${solicitud.id}</p>
            <p><b>Docente:</b> ${solicitud.docente}</p>
            <p><b>Asignatura:</b> ${solicitud.asignatura}</p>
            <p><b>Fecha:</b> ${new Date(solicitud.fecha).toLocaleString()}</p>
            <p><b>Materiales:</b></p>
            <ul class="materiales">
                ${solicitud.materiales.map(m => `<li>${m.nombre} - Cantidad: ${m.cantidad}</li>`).join('')}
            </ul>
        `;
        container.appendChild(div);
    });
}

async function cargarHistorial() {
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user) {
        alert("No hay usuario logueado.");
        window.location.href = "index.html";
        return;
    }

    try {
        const res = await fetch(`${API_URL}?action=getHistorial&email=${user.email}`);
        const json = await res.json();

        if (!json.ok) {
            document.getElementById("historialContainer").innerHTML = "<p>Error al cargar historial.</p>";
            return;
        }

        mostrarHistorial(json.data);
    } catch (err) {
        document.getElementById("historialContainer").innerHTML = "<p>Error al cargar historial.</p>";
    }
}

document.getElementById("fechaFiltro").addEventListener("change", cargarHistorial);
cargarHistorial();
</script>

</body>
</html>





