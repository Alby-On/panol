<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Web Pañol</title>
<style>
  body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 20px auto;
      text-align: center;
      background-color: #f0f2f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 0px 15px rgba(0,0,0,0.1);
  }
  input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
  }
  button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
  }
  button:hover {
      background-color: #0056b3;
  }
  .pantalla {
      display: none;
  }
  h2 {
      color: #333;
  }
  ul {
      text-align: left;
  }
</style>
</head>
<body>

<!-- PANTALLA DE BIENVENIDA -->
<div id="welcomepage" class="pantalla">
    <h2>Bienvenido al Sistema de Solicitud de Materiales</h2>
    <p>Esta plataforma permite a los alumnos y docentes solicitar materiales e insumos del pañol.</p>
    <button onclick="mostrarLogin()">Iniciar Sesión</button>
    <button onclick="mostrarRegistro()">Registrarse</button>
</div>

<!-- REGISTRO -->
<div id="registerpage" class="pantalla">
    <h2>Registro de Usuario</h2>
    <input id="regNombre" type="text" placeholder="Nombre completo">
    <input id="regCarrera" type="text" placeholder="Carrera">
    <input id="regTelefono" type="text" placeholder="Teléfono (+56912345678)">
    <input id="regEmail" type="email" placeholder="Correo">
    <input id="regPass" type="password" placeholder="Contraseña">
    <button onclick="registrar()">Registrarse</button>
    <button onclick="volver()">Volver</button>
</div>

<!-- LOGIN -->
<div id="loginpage" class="pantalla">
    <h2>Iniciar Sesión</h2>
    <input id="logEmail" type="email" placeholder="Correo">
    <input id="logPass" type="password" placeholder="Contraseña">
    <button onclick="login()">Entrar</button>
    <button onclick="volver()">Volver</button>
</div>

<!-- FORMULARIO -->
<div id="formpage" class="pantalla">
    <h2>Solicitud de Material</h2>
    <input id="material" placeholder="Material solicitado">
    <input id="cantidad" type="number" placeholder="Cantidad">
    <input id="comentario" placeholder="Comentario">
    <button onclick="enviarSolicitud()">Enviar Solicitud</button>
    <button onclick="cerrarSesion()">Cerrar Sesión</button>

    <h3>Solicitudes Pendientes</h3>
    <ul id="solicitudesList"></ul>
</div>

<script>
  // Manejo de pantallas
  function mostrar(id) {
      document.querySelectorAll(".pantalla").forEach(p => p.style.display = "none");
      document.getElementById(id).style.display = "block";
  }

  function mostrarLogin() { mostrar("loginpage"); }
  function mostrarRegistro() { mostrar("registerpage"); }
  function volver() { mostrar("welcomepage"); }

  // Registro
  function registrar() {
      const nombre = document.getElementById("regNombre").value.trim();
      const carrera = document.getElementById("regCarrera").value.trim();
      const telefono = document.getElementById("regTelefono").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const pass = document.getElementById("regPass").value.trim();

      if(!nombre || !carrera || !telefono || !email || !pass) {
          alert("Complete todos los campos");
          return;
      }

      const telRegex = /^\+569\d{8}$/;
      if(!telRegex.test(telefono)) {
          alert("Número de teléfono inválido. Formato: +569xxxxxxxx");
          return;
      }

      let users = JSON.parse(localStorage.getItem("users") || "[]");
      if(users.find(u => u.email === email)) {
          alert("Usuario ya existe");
          return;
      }

      users.push({nombre, carrera, telefono, email, pass});
      localStorage.setItem("users", JSON.stringify(users));
      alert("Usuario registrado ✅");
      mostrarLogin();
  }

  // Login
  function login() {
      const email = document.getElementById("logEmail").value.trim();
      const pass = document.getElementById("logPass").value.trim();
      let users = JSON.parse(localStorage.getItem("users") || "[]");
      let user = users.find(u => u.email === email && u.pass === pass);
      if(user) {
          localStorage.setItem("currentUser", JSON.stringify(user));
          mostrar("formpage");
          mostrarSolicitudes();
      } else {
          alert("Correo o contraseña incorrectos");
      }
  }

  // Cerrar sesión
  function cerrarSesion() {
      localStorage.removeItem("currentUser");
      mostrar("welcomepage");
  }

  // Manejo de solicitudes
  function enviarSolicitud() {
      const material = document.getElementById("material").value.trim();
      const cantidad = document.getElementById("cantidad").value.trim();
      const comentario = document.getElementById("comentario").value.trim();
      const user = JSON.parse(localStorage.getItem("currentUser"));

      if(!material || !cantidad) { alert("Complete los campos"); return; }

      let solicitudes = JSON.parse(localStorage.getItem("solicitudes") || "[]");
      solicitudes.push({
          email: user.email,
          nombre: user.nombre,
          carrera: user.carrera,
          telefono: user.telefono,
          material,
          cantidad,
          comentario,
          estado: "Pendiente"
      });
      localStorage.setItem("solicitudes", JSON.stringify(solicitudes));
      alert("Solicitud enviada ✅");
      document.getElementById("material").value = "";
      document.getElementById("cantidad").value = "";
      document.getElementById("comentario").value = "";
      mostrarSolicitudes();
  }

  function mostrarSolicitudes() {
      const user = JSON.parse(localStorage.getItem("currentUser"));
      const solicitudes = JSON.parse(localStorage.getItem("solicitudes") || "[]")
                                .filter(s => s.email === user.email);
      const list = document.getElementById("solicitudesList");
      list.innerHTML = "";
      solicitudes.forEach(s => {
          const li = document.createElement("li");
          li.textContent = `${s.material} - Cantidad: ${s.cantidad} - ${s.comentario} - Estado: ${s.estado}`;
          list.appendChild(li);
      });
  }

  // Inicio automático
  if(localStorage.getItem("currentUser")) {
      mostrar("formpage");
      mostrarSolicitudes();
  } else {
      mostrar("welcomepage");
  }
</script>

</body>
</html>







